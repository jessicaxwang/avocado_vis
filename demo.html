<!DOCTYPE html>
<meta charset="utf-8">

<script src="js/d3.v4.min.js"></script>
<script src="js/topojson.v1.min.js"></script>
<style>
    html, body {
        padding: 0;
        margin: 0;
    }

    .states {
        fill: #583a3f;
        stroke: #fff;
    }
</style>
<div id='map'></div>
<div id='firstbar'></div>
<div id='totalBar'></div>

<script>

    var chartDiv = document.getElementById('map')
    var pageWidth = window.innerWidth;
    var pageHeight = window.innerHeight;
    var regionMap = d3.map();


    // Create Map
    var projection = d3.geoAlbersUsa()
        .translate([pageWidth / 2, pageHeight / 4])
        .scale([1000]);

    var path = d3.geoPath()
                .projection(projection);

    var mapSvg = d3.select('#map').append('svg')
        .attr('width', pageWidth)
        .attr('height', pageHeight/2)
        .style("background-color", "#568203")

    d3.json("js/us.json", function(error, us){
        mapSvg.append("path")
            .attr("class", "states")
            .datum(topojson.feature(us, us.objects.states))
            .attr("d", path);
    })

    // Shaping the data
    d3.csv('./totalAvocado.csv', function(d){
        return {
            week: d.Date,
            year: d.year,
            avgPrice: +d.AveragePrice,
            region: d.region,
            totalVolume: +d["Total Volume"],
            type: d.type
        };
    }, function(error, rows) {
        process(rows)
    });

    /* Populate hashmap to order by region and year
    Key: [region, year]
    Value: [{
        week,
        avgPrice,
        totalVolume
    }]
    */
    function populateRegionMap(data) {
        data.forEach(function(d) {
            if (regionMap.has([d.region, d.year])) {
                regionMap.get([d.region, d.year]).push({
                    week: d.week,
                    avgPrice: +d.avgPrice,
                    totalVolume: +d.totalVolume
                });
            } else {
                regionMap.set([d.region, d.year], [{
                    week: d.week,
                    avgPrice: +d.avgPrice,
                    totalVolume: +d.totalVolume
                }])
            }
        });
        console.log(regionMap)
    }
 
    function process(data){
        populateRegionMap(data);

  
    }

    

</script>
