<!DOCTYPE html>
<meta charset="utf-8">

<script src="js/d3.v4.min.js"></script>
<script src="js/topojson.v1.min.js"></script>
<style>
    html, body {
        padding: 0;
        margin: 0;
    }
</style>
<div id='map'></div>
<div id='firstbar'></div>
<div id='totalBar'></div>

<script>

    // adding a comment test test
    var chartDiv = document.getElementById('map')
    var width = window.innerWidth;
    var height = window.innerHeight;
    var regionMap = d3.map();

    var svg = d3.select('#map').append('svg')
        .attr('width', width)
        .attr('height', height)
        .style('background-color', '#F7F3B0')

    // Shaping the data
    d3.csv('./totalAvocado.csv', function(d){
        return {
            week: d.Date,
            year: d.year,
            avgPrice: +d.AveragePrice,
            region: d.region,
            totalVolume: +d["Total Volume"],
            type: d.type
        };
    }, function(error, rows) {
        process(rows)
    });
    
    var projection = d3.geoAlbersUsa()
    var path = d3.geoPath()
    .projection(projection);

    /* Populate hashmap to order by region and year
    Key: [region, year]
    Value: [{
        week,
        avgPrice,
        totalVolume
    }]
    */
    function populateRegionMap(data) {
        data.forEach(function(d) {
            if (regionMap.has([d.region, d.year])) {
                regionMap.get([d.region, d.year]).push({
                    week: d.week,
                    avgPrice: +d.avgPrice,
                    totalVolume: +d.totalVolume
                });
            } else {
                regionMap.set([d.region, d.year], [{
                    week: d.week,
                    avgPrice: +d.avgPrice,
                    totalVolume: +d.totalVolume
                }])
            }
        });
    }
 
    function process(data){
        populateRegionMap(data);
        margin = {top: 20, right: 20, bottom: 30, left: 50};
        width = 960 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;

        var x = d3.scaleTime().range([0, width]);
        var y = d3.scaleLinear().range([height, 0]);

        var valueline = d3.line()
            .x(function(d) { return x(d.week); })
            .y(function(d) { return y(d.avgPrice); });

        var lineGraph = d3.select("#firstbar").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
            .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        x.domain(d3. extent(data, function(d) { 
            console.log(d)
            return d.week; }));
        y.domain([0, d3.max(data, function(d) { return d.avgPrice; })]);

        svg.append("path")
            .data([data])
            .attr("class", "line")
            .attr("d", valueline);
        
        svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x));

        // Add the Y Axis
        svg.append("g")
            .call(d3.axisLeft(y));

        // map.append("g")
        //     .enter().append("path")
        //         .attr("d", path);

        // map.append("path")
        //     .attr("d", path);

        // data.forEach(function(d) {
        //     map.append("circle").attr("r",2).attr("transform", function() {return "translate(" + projection([d.long,d.lat]) + ")";});

        // })
        //console.log(data)
    }

</script>
